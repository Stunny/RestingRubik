doctype html
html(lang='en')
  head
    link(rel='stylesheet', href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/default.min.css')
    script(src='//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js')
    meta(charset='utf-8')
    style(media="screen").
      input{
        margin : 5px
      }
    title RestingRubik - Delete Form
  body
    a(href=serveraddress, id='back') Index
    input(type='text', id='token', placeholder='API Token')
    h1 Delete Form
    div(class'getFrame', style='width:50%; height:80%; float:left;')
      form(id='getForm')
        input(type='radio', name='get', value='radioC')
        | Cube
        input(type='radio', name='get', value='radioA')
        | Algorithm
        input(type='radio', name='get', value='radioG')
        | Guide
        input(type='submit', value='GET', style='margin-left: 5px;')
      div(id='getter', style='height:500px; overflow:auto; margin-top:10px;')
        pre
          code(id='get_body')
    div(class='deleteFrame', style='width:45%; float:left; text-align:center; padding-left:5px;')
      h2(style='margin:0') Delete Element
      form(id='deleteForm')
        input(type='text', id='deleteID', placeholder='Element ID', style='margin-top:10px; margin-bottom:5px;')
        br
        input(type='submit')
      div(id='deleter')
        pre
          code(id='delete_result')
    script.
      
      //Start the script
      
      var deleteType;
      
      $('#getForm').submit(function(event){
        
        var token = $('#token').val();
        
        $.ajaxSetup({
          headers: {'x-access-token' : token}
        });

        event.preventDefault();
        
        var link = $('#back').attr('href')+'api/',
            getRadio = $('#getForm input[name="get"]'),
            checked = getRadio.filter(':checked').val();
        
        if(checked == 'radioC'){ 
          link = link +'cube';
          deleteType = 'cube';
        }
        if(checked == 'radioA'){ 
          link = link +'alg';
          deleteType = 'alg';
        }
        if(checked == 'radioG'){ 
          link = link +'guide'
          deleteType = 'guide';
        }
        
        //var get = $.get(link, {token : token}, "application/json");
        var get = $.ajax({
          async : true,
          type : 'get',
          url: link,
        });
        
        get.done(function(elmts, textStatus){
          if($('#get_body').hasClass()) $('#get_body').removeAttr('class');
          
          console.log(elmts);
          console.log(textStatus);
          
          $('#get_body').addClass('json');
          $('#get_body').text(JSON.stringify(elmts, null, "\t"));
          hljs.highlightBlock($('#get_body').get(0));
        });
        
        get.fail(function(jqxhr, textStatus, errorThrown){
          console.log(textStatus, errorThrown, errorThrown.msg);
        });
      });
      
      $('#deleteForm').submit(function(event){
        
        event.preventDefault();
        
        var form = $(this),
            elmtID = form.find('input[id="deleteID"]'),
            link = $('#back').attr('href') + 'api/' + deleteType+'/'+elmtID;
        
        var deleting = $.ajax({
          async:   true,
          url:     link,
          type:    'delete'
        });
        
        deleting.done(function(resData, textStatus){
                  if($('#delete_result').hasClass()) $('#delete_result').removeAttr('class');
                  console.log(resData);
                  console.log(textStatus);
                  $('#delete_result').addClass('json');
                  $('#delete_result').text(JSON.stringify(resData, null, "\t"));
                  hljs.highlightBlock($('#put_result').get(0));
                });
        deleting.fail(function(jqxhr, textStatus, errorThrown){
                  console.log(textStatus, errorThrown);
                });
        
      });  
